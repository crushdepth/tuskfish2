<?php declare(strict_types=1); ?>

<!-- Container -->
<div class="container">

  <div class="row">
    <div class="col">
      <h1 class="page-title"><?php echo xss($viewModel->pageTitle()); ?></h1>
    </div>
  </div>

  <!-- Embed PHP blockTemplates into a JavaScript variable -->
  <script>
    const templates = <?php echo \json_encode($viewModel->blockTemplates(), JSON_HEX_TAG | JSON_HEX_APOS | JSON_HEX_AMP | JSON_HEX_QUOT); ?>;
  </script>

  <form class="form-horizontal" action="<?php echo TFISH_ADMIN_BLOCK_URL . 'edit/'; ?>" method="post"
    role="form" accept-charset="UTF-8">

    <!-- Row -->
    <div class="row justify-content-center">

    <!-- Type -->
    <div class="col-md-3 mb-3">
      <label for="type"><strong>Type</strong> <span class="text-danger">*</span></label>
      <div class="form-group">
        <select class="form-control" name="content[type]" id="type" onchange="updateTemplateOptions()" required>
          <option value="" selected><?php echo TFISH_SELECT_TYPE; ?></option>
          <?php
            $options = $viewModel->blockTypes();
            foreach ($options as $value => $label) {
              echo '<option value="' . xss($value) . '">' . xss($label) . '</option>';
            }
          ?>
        </select>
      </div>
    </div>

    <!-- Template -->
    <div class="col-md-3 mb-3">
      <label for="template"><strong>Template</strong> <span class="text-danger">*</span></label>
      <div class="form-group">
        <select class="form-control" name="content[template]" id="template" required>
          <option value="" disabled selected><?php echo TFISH_SELECT_TEMPLATE; ?></option>
          <!-- Options will be dynamically populated -->
        </select>
      </div>
    </div>

      <!-- Position -->
      <div class="col-md-3 mb-3">
        <label for="position"><strong>Position</strong> <span class="text-danger">*</span></label>
        <div class="form-group">
          <select class="form-control" name="content[position]" id="position" required>
            <option value="" disabled selected><?php echo TFISH_SELECT_POSITION; ?></option>
            <?php
              $options = $viewModel->blockPositions();
              foreach ($options as $value => $label) {
                echo '<option value="' . xss($value) . '">' . xss($label) . '</option>';
              }
            ?>
          </select>
        </div>
      </div>

      <!-- Route -->
      <div class="col-md-3 mb-3">
        <label for="route"><strong>Route</strong> <span class="text-danger">*</span></label>
        <div class="form-group">
          <select class="form-control" name="content[route][]" id="route" multiple size="5">
            <option value=""><?php echo TFISH_SELECT_ROUTE; ?></option>
            <?php
              $options = $viewModel->blockRoutes();
              foreach ($options as $value => $label) {
                echo '<option value="' . xss($value) . '">' . xss($label) . '</option>';
              }
            ?>
          </select>
        </div>
      </div>

    <!-- /row -->
    </div>

    <!-- Row -->
    <div class="row justify-content-center">

    <!-- Title -->
    <div class="col-md-6 mb-3">
      <label for="title"><strong>Title</strong></label>
      <div class="form-group input-group">
        <input type="text" class="form-control" name="content[title]" id="title">
      </div>
    </div>

    <!-- Weight -->
    <div class="col-md-3 mb-3">
      <label for="weight"><strong>Weight</strong> <span class="text-danger">*</span></label>
      <div class="form-group input-group">
        <input type="number" class="form-control" name="content[weight]" id="weight" value="0" required>
      </div>
    </div>

    <!-- Online Status -->
    <div class="col-md-3 mb-3">
      <label for="onlineStatus"><strong><?php echo TFISH_ONLINE_STATUS; ?></strong> <span class="text-danger">*</span></label>
      <div class="form-group">
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="content[onlineStatus]" id="online" value="1" required>
          <label class="form-check-label" for="online"><?php echo TFISH_ONLINE; ?></label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="content[onlineStatus]" id="offline" value="0" checked>
          <label class="form-check-label" for="offline"><?php echo TFISH_OFFLINE; ?></label>
        </div>
      </div>
    </div>

    <!-- /row -->
    </div>

    <!-- Row -->
    <div class="row justify-content-center">

    <!-- HTML -->
    <div class="col-md-12 mb-3">
      <label for="html"><strong>HTML</strong></label>
      <div class="form-group">
        <textarea class="form-control" name="content[html]" id="html" rows="4"></textarea>
      </div>
    </div>

    <!-- /row -->
    </div>

    <!-- Row -->
    <div class="row justify-content-center">

    <!-- Config -->
    <div class="col-md-12 mb-3">
      <label for="config"><strong>Config</strong></label>
      <div class="form-group">
        <textarea class="form-control" name="content[config]" id="config" rows="4"></textarea>
      </div>
    </div>

    <!-- /row -->
    </div>

    <!-- Row -->
    <div class="row justify-content-center">

    <!-- Action Buttons -->
    <div class="col-md-12 text-left">
      <input type="hidden" name="token" value="<?php echo xss($_SESSION['token']); ?>" />
      <button name="action" value="save" type="submit" class="btn btn-primary"><?php echo TFISH_SUBMIT; ?></button>
      <button name="action" value="cancel" type="submit" class="btn btn-primary" formnovalidate><?php echo TFISH_CANCEL; ?></button>
    </div>

    <!-- /row -->
    </div>

  </form>

</div>

<script>
  // Function to update the 'template' select box options
  function updateTemplateOptions() {
    const typeField = document.getElementById('type'); // Type dropdown
    const templateField = document.getElementById('template'); // Template dropdown
    const selectedType = typeField.value; // Get selected 'type'

    // Clear the current template options
    templateField.innerHTML = '';

    // Get the templates for the selected type
    const typeTemplates = templates[selectedType] || {};

    // Populate the template dropdown
    for (const [value, label] of Object.entries(typeTemplates)) {
      const option = document.createElement('option');
      option.value = value;
      option.textContent = label;
      templateField.appendChild(option);
    }
  }
</script>